<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>CryptoX Admin - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #f3f4f6;
      --bg-soft: #ffffff;
      --primary: #1652f0;
      --primary-soft: #e5edff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-soft: #e5e7eb;
      --danger: #dc2626;
      --success: #16a34a;
      --pending: #f97316;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text-main);
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .admin-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 52px;
      background: #ffffff;
      border-bottom: 1px solid var(--border-soft);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 18px 0 60px;
      z-index: 30;
    }

    .admin-header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-badge {
      width: 26px;
      height: 26px;
      border-radius: 8px;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 14px;
    }

    .logo-text {
      font-weight: 700;
      font-size: 16px;
    }

    .logo-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .admin-header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .btn {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 11px;
      border: 1px solid transparent;
      cursor: pointer;
      background: transparent;
    }

    .btn-outline {
      border-color: var(--border-soft);
      background: #fff;
      color: var(--text-main);
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    /* å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 200px;
      bottom: 0;
      background: #0f172a;
      color: #e5e7eb;
      padding-top: 52px; /* header åˆ† */
      display: flex;
      flex-direction: column;
      border-right: 1px solid #020617;
      z-index: 20;
    }

    .sidebar-title {
      padding: 10px 14px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #6b7280;
    }

    .nav-list {
      list-style: none;
      margin: 0;
      padding: 0 8px 12px;
    }

    .nav-item {
      margin-bottom: 4px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 8px;
      border-radius: 8px;
      font-size: 12px;
      color: #9ca3af;
      cursor: pointer;
    }

    .nav-link:hover {
      background: rgba(148, 163, 184, 0.15);
      color: #e5e7eb;
    }

    .nav-link.active {
      background: #111827;
      color: #e5e7eb;
      border: 1px solid rgba(129, 140, 248, 0.5);
    }

    .nav-icon {
      width: 14px;
      text-align: center;
      font-size: 12px;
    }

    .sidebar-footer {
      margin-top: auto;
      padding: 10px 14px 12px;
      font-size: 11px;
      color: #6b7280;
      border-top: 1px solid rgba(31, 41, 55, 0.9);
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    .main {
      margin-left: 200px;
      padding-top: 52px;
    }

    .main-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 16px 18px 24px;
    }

    .page-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .page-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    /* æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */
    .search-card {
      background: var(--bg-soft);
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      padding: 10px 12px 8px;
      margin-bottom: 10px;
      box-shadow: 0 1px 2px rgba(15,23,42,0.03);
    }

    .search-row-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .search-title {
      font-size: 13px;
      font-weight: 600;
    }

    .search-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    .search-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }

    @media (max-width: 960px) {
      .search-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .search-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-size: 11px;
    }

    .form-field label {
      color: var(--text-muted);
    }

    .form-field input,
    .form-field select {
      border-radius: 6px;
      border: 1px solid var(--border-soft);
      padding: 6px 7px;
      font-size: 11px;
      outline: none;
      background: #fff;
    }

    .form-field input:focus,
    .form-field select:focus {
      border-color: var(--primary);
    }

    .search-actions {
      display: flex;
      gap: 6px;
      margin-top: 8px;
      justify-content: flex-end;
    }

    .btn-xs {
      padding: 4px 9px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #fff;
      cursor: pointer;
    }

    .btn-xs-primary {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }

    /* ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ */
    .summary-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    @media (max-width: 960px) {
      .summary-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .summary-grid {
        grid-template-columns: 1fr;
      }
    }

    .summary-card {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      padding: 8px 10px 7px;
      font-size: 11px;
      box-shadow: 0 1px 2px rgba(15,23,42,0.03);
    }

    .summary-label {
      color: var(--text-muted);
      margin-bottom: 3px;
    }

    .summary-value {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .summary-sub {
      font-size: 10px;
      color: var(--text-muted);
    }

    /* ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« */
    .table-card {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      padding: 10px 10px 8px;
      box-shadow: 0 1px 2px rgba(15,23,42,0.03);
    }

    .table-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .table-title {
      font-size: 13px;
      font-weight: 600;
    }

    .table-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    th, td {
      padding: 6px 4px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      white-space: nowrap;
    }

    th {
      color: var(--text-muted);
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }

    th.sortable:hover {
      color: var(--primary);
    }

    th .sort-indicator {
      margin-left: 3px;
      font-size: 10px;
      opacity: 0.7;
    }

    td.amount {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    .status-chip {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 10px;
      font-weight: 500;
    }

    .status-active {
      background: #dcfce7;
      color: var(--success);
    }

    .status-pending {
      background: #ffedd5;
      color: var(--pending);
    }

    .status-suspended {
      background: #fee2e2;
      color: var(--danger);
    }

    .table-row:hover {
      background: #f9fafb;
    }

    .tag {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 2px 6px;
      font-size: 10px;
      color: var(--text-muted);
    }

    @media (max-width: 768px) {
      .admin-header {
        padding-left: 54px;
      }
      .sidebar {
        width: 180px;
      }
      .main {
        margin-left: 180px;
      }
    }

    @media (max-width: 640px) {
      .sidebar {
        position: fixed;
        transform: translateX(-100%);
      }
      .main {
        margin-left: 0;
      }
      .admin-header {
        padding-left: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
  <aside class="sidebar">
    <div class="sidebar-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
    <ul class="nav-list">
      <li class="nav-item">
        <a href="index.html" class="nav-link active">
          <span class="nav-icon">ğŸ </span><span>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="tickets.html" class="nav-link">
          <span class="nav-icon">ğŸ’¬</span><span>å•ã„åˆã‚ã›ç®¡ç†</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="users.html" class="nav-link">
          <span class="nav-icon">ğŸ‘¥</span><span>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</span>
        </a>
      </li>
        <li class="nav-item">
        <a href="trades.html" class="nav-link">
          <span class="nav-icon">ğŸ“Š</span><span>å–å¼•çŠ¶æ³</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="kyc.html" class="nav-link">
          <span class="nav-icon">ğŸ“Š</span><span>KYCçŠ¶æ³</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="deposit.html" class="nav-link">
          <span class="nav-icon">â•</span><span>å…¥é‡‘ç”³è«‹</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="withdraw.html" class="nav-link">
          <span class="nav-icon">â–</span><span>å‡ºé‡‘ç”³è«‹</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="group.html" class="nav-link">
          <span class="nav-icon">ğŸ§©</span><span>ã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="settings.html" class="nav-link">
          <span class="nav-icon">âš™ï¸</span><span>ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</span>
        </a>
      </li>
    </ul>
    <div class="sidebar-footer">
      CryptoX Admin<br />UI Demo &copy; 2025
    </div>
  </aside>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="admin-header">
    <div class="admin-header-left">
      <div class="logo-badge">AX</div>
      <div>
        <div class="logo-text">Admin Console</div>
        <div class="logo-sub">CryptoX Exchange</div>
      </div>
    </div>
    <div class="admin-header-right">
      <span>ç®¡ç†è€…ï¼šadmin@example.com</span>
      <button class="btn btn-outline btn-sm" onclick="location.href='login.html'">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆãƒ‡ãƒ¢ï¼‰</button>
    </div>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="main">
    <div class="main-inner">
      <div class="page-title">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
      <div class="page-sub">
        å…¨ä½“ã®çŠ¶æ³ã‚’ç¢ºèªã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ / å…¥å‡ºé‡‘ / å•ã„åˆã‚ã›ã«ç´ æ—©ãã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
      </div>

      <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
      <section class="search-card">
        <div class="search-row-top">
          <div>
            <div class="search-title">ã‚°ãƒ­ãƒ¼ãƒãƒ«æ¤œç´¢</div>
            <div class="search-meta">
              ãƒ¦ãƒ¼ã‚¶ãƒ¼å / ãƒ¡ãƒ¼ãƒ« / ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ / æ—¥ä»˜ã§çµã‚Šè¾¼ã¿ã§ãã¾ã™ã€‚
            </div>
          </div>
          <span class="tag">å¯¾è±¡ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ / å…¥å‡ºé‡‘ / å•ã„åˆã‚ã›</span>
        </div>

        <div class="search-grid">
          <div class="form-field">
            <label>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆåå‰ãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼‰</label>
            <input type="text" id="q-text" placeholder="ä¾‹ï¼šTaro / user@example.com / user-demo-001" />
          </div>
          <div class="form-field">
            <label>ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰</label>
            <input type="text" id="q-affiliate" placeholder="ä¾‹ï¼šAFF-12345" />
          </div>
          <div class="form-field">
            <label>æœŸé–“ï¼ˆFromï¼‰</label>
            <input type="date" id="q-from" />
          </div>
          <div class="form-field">
            <label>æœŸé–“ï¼ˆToï¼‰</label>
            <input type="date" id="q-to" />
          </div>
        </div>

        <div class="search-actions">
          <button class="btn-xs" id="btn-clear">æ¡ä»¶ã‚¯ãƒªã‚¢</button>
          <button class="btn-xs btn-xs-primary" id="btn-search">æ¤œç´¢</button>
        </div>
      </section>

      <!-- ã‚µãƒãƒªãƒ¼ -->
      <section class="summary-grid">
        <div class="summary-card">
          <div class="summary-label">ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ï¼ˆãƒ‡ãƒ¢ï¼‰</div>
          <div class="summary-value" id="sum-users">0</div>
          <div class="summary-sub">æœ¬ç•ªç’°å¢ƒã§ã¯DBã‹ã‚‰å–å¾—</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">æœªå¯¾å¿œå•ã„åˆã‚ã›</div>
          <div class="summary-value" id="sum-tickets-new">0</div>
          <div class="summary-sub">status = new ã®ä»¶æ•°</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">å…¥é‡‘ç”³è«‹ä¸­</div>
          <div class="summary-value" id="sum-dep-pending">0</div>
          <div class="summary-sub">pending ã®å…¥é‡‘ç”³è«‹ä»¶æ•°ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">å‡ºé‡‘ç”³è«‹ä¸­</div>
          <div class="summary-value" id="sum-wd-pending">0</div>
          <div class="summary-sub">pending ã®å‡ºé‡‘ç”³è«‹ä»¶æ•°ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰</div>
        </div>
      </section>

      <!-- æƒ…å ±ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« -->
      <section class="table-card">
        <div class="table-header-row">
          <div class="table-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ / ç”³è«‹ / å•ã„åˆã‚ã› ä¸€è¦§ï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰</div>
          <div class="table-meta" id="table-meta">0ä»¶ã‚’è¡¨ç¤ºä¸­</div>
        </div>
        <table>
          <thead>
            <tr>
              <th class="sortable" data-sort-key="createdAt">ä½œæˆæ—¥æ™‚<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="type">ç¨®åˆ¥<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="nameOrTitle">åå‰ / ã‚¿ã‚¤ãƒˆãƒ«<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="userId">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="affiliateCode">ã‚¢ãƒ•ã‚£ãƒªã‚³ãƒ¼ãƒ‰<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="amount" style="text-align:right;">é‡‘é¡ï¼ˆUSDï¼‰<span class="sort-indicator"></span></th>
              <th class="sortable" data-sort-key="statusLabel">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹<span class="sort-indicator"></span></th>
            </tr>
          </thead>
          <tbody id="table-body">
            <!-- JSã§æç”» -->
          </tbody>
        </table>
      </section>
    </div>
  </main>

  <script>
    // ===== ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ =====
    // type: user / ticket / deposit / withdraw
    const rows = [
      {
        id: "user-001",
        type: "user",
        typeLabel: "ãƒ¦ãƒ¼ã‚¶ãƒ¼",
        nameOrTitle: "Taro Yamada",
        userId: "user-demo-001",
        affiliateCode: "AFF-12345",
        amount: null,
        status: "active",
        statusLabel: "æœ‰åŠ¹",
        createdAt: "2025-11-18 10:15",
      },
      {
        id: "user-002",
        type: "user",
        typeLabel: "ãƒ¦ãƒ¼ã‚¶ãƒ¼",
        nameOrTitle: "Hanako Suzuki",
        userId: "user-demo-002",
        affiliateCode: "AFF-77777",
        amount: null,
        status: "pending",
        statusLabel: "KYCç¢ºèªä¸­",
        createdAt: "2025-11-19 09:05",
      },
      {
        id: "ticket-001",
        type: "ticket",
        typeLabel: "å•ã„åˆã‚ã›",
        nameOrTitle: "å…¥é‡‘ãŒåæ˜ ã•ã‚Œã¾ã›ã‚“",
        userId: "user-demo-001",
        affiliateCode: "AFF-12345",
        amount: null,
        status: "new",
        statusLabel: "æœªå¯¾å¿œ",
        createdAt: "2025-11-19 08:30",
      },
      {
        id: "dep-001",
        type: "deposit",
        typeLabel: "å…¥é‡‘ç”³è«‹",
        nameOrTitle: "éŠ€è¡ŒæŒ¯è¾¼ JPY",
        userId: "user-demo-003",
        affiliateCode: "AFF-00001",
        amount: 1000.0,
        status: "pending",
        statusLabel: "ç”³è«‹ä¸­",
        createdAt: "2025-11-19 07:45",
      },
      {
        id: "wd-001",
        type: "withdraw",
        typeLabel: "å‡ºé‡‘ç”³è«‹",
        nameOrTitle: "BTC å‡ºé‡‘",
        userId: "user-demo-001",
        affiliateCode: "AFF-12345",
        amount: 0.5 * 67000,
        status: "pending",
        statusLabel: "ç”³è«‹ä¸­",
        createdAt: "2025-11-18 22:10",
      },
      {
        id: "ticket-002",
        type: "ticket",
        typeLabel: "å•ã„åˆã‚ã›",
        nameOrTitle: "ã‚·ã‚¹ãƒ†ãƒ å–å¼•ã®è¨­å®šã«ã¤ã„ã¦",
        userId: "user-demo-004",
        affiliateCode: "",
        amount: null,
        status: "open",
        statusLabel: "å¯¾å¿œä¸­",
        createdAt: "2025-11-18 16:20",
      },
      {
        id: "dep-002",
        type: "deposit",
        typeLabel: "å…¥é‡‘ç”³è«‹",
        nameOrTitle: "USDT å…¥é‡‘",
        userId: "user-demo-002",
        affiliateCode: "AFF-77777",
        amount: 500.0,
        status: "completed",
        statusLabel: "å®Œäº†",
        createdAt: "2025-11-17 19:00",
      },
      {
        id: "wd-002",
        type: "withdraw",
        typeLabel: "å‡ºé‡‘ç”³è«‹",
        nameOrTitle: "USDT å‡ºé‡‘",
        userId: "user-demo-005",
        affiliateCode: "",
        amount: 200.0,
        status: "admin_cancel",
        statusLabel: "ç®¡ç†å´ã‚­ãƒ£ãƒ³ã‚»ãƒ«",
        createdAt: "2025-11-17 15:30",
      },
      {
        id: "user-003",
        type: "user",
        typeLabel: "ãƒ¦ãƒ¼ã‚¶ãƒ¼",
        nameOrTitle: "Suspended User",
        userId: "user-demo-999",
        affiliateCode: "AFF-99999",
        amount: null,
        status: "suspended",
        statusLabel: "åœæ­¢ä¸­",
        createdAt: "2025-11-10 11:11",
      }
    ];

    // ===== æ¤œç´¢ç”¨ =====
    const qTextEl = document.getElementById("q-text");
    const qAffEl = document.getElementById("q-affiliate");
    const qFromEl = document.getElementById("q-from");
    const qToEl = document.getElementById("q-to");
    const btnSearch = document.getElementById("btn-search");
    const btnClear = document.getElementById("btn-clear");
    const tableBody = document.getElementById("table-body");
    const tableMeta = document.getElementById("table-meta");
    const sumUsersEl = document.getElementById("sum-users");
    const sumTicketsNewEl = document.getElementById("sum-tickets-new");
    const sumDepPendingEl = document.getElementById("sum-dep-pending");
    const sumWdPendingEl = document.getElementById("sum-wd-pending");

    let currentSortKey = "createdAt";
    let currentSortDir = "desc"; // asc or desc
    let filteredRows = rows.slice();

    function parseDateTime(str) {
      // "YYYY-MM-DD HH:MM" â†’ Date
      return new Date(str.replace(" ", "T"));
    }

    function applyFilters() {
      const text = qTextEl.value.trim().toLowerCase();
      const aff = qAffEl.value.trim().toLowerCase();
      const fromVal = qFromEl.value;
      const toVal = qToEl.value;

      filteredRows = rows.filter((r) => {
        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆåå‰ã€ã‚¿ã‚¤ãƒˆãƒ«ã€ãƒ¡ãƒ¼ãƒ«ç›¸å½“ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼‰
        if (text) {
          const haystack =
            (r.nameOrTitle || "").toLowerCase() +
            " " +
            (r.userId || "").toLowerCase();
          if (!haystack.includes(text)) return false;
        }

        // ã‚¢ãƒ•ã‚£ãƒªã‚³ãƒ¼ãƒ‰
        if (aff) {
          const code = (r.affiliateCode || "").toLowerCase();
          if (!code.includes(aff)) return false;
        }

        // æ—¥ä»˜ç¯„å›²
        if (fromVal) {
          const fromTs = new Date(fromVal + "T00:00:00").getTime();
          if (parseDateTime(r.createdAt).getTime() < fromTs) return false;
        }
        if (toVal) {
          const toTs = new Date(toVal + "T23:59:59").getTime();
          if (parseDateTime(r.createdAt).getTime() > toTs) return false;
        }

        return true;
      });

      applySort();
      renderTable();
    }

    function applySort() {
      const key = currentSortKey;
      const dir = currentSortDir;

      filteredRows.sort((a, b) => {
        let va, vb;

        if (key === "createdAt") {
          va = parseDateTime(a.createdAt).getTime();
          vb = parseDateTime(b.createdAt).getTime();
        } else if (key === "amount") {
          va = a.amount == null ? -Infinity : a.amount;
          vb = b.amount == null ? -Infinity : b.amount;
        } else {
          va = (a[key] || "").toString().toLowerCase();
          vb = (b[key] || "").toString().toLowerCase();
        }

        if (va < vb) return dir === "asc" ? -1 : 1;
        if (va > vb) return dir === "asc" ? 1 : -1;
        return 0;
      });
    }

    function renderTable() {
      tableBody.innerHTML = "";
      filteredRows.forEach((r) => {
        const tr = document.createElement("tr");
        tr.className = "table-row";

        const statusChip = (() => {
          if (r.type === "user") {
            if (r.status === "active") return `<span class="status-chip status-active">æœ‰åŠ¹</span>`;
            if (r.status === "pending") return `<span class="status-chip status-pending">KYCç¢ºèªä¸­</span>`;
            if (r.status === "suspended") return `<span class="status-chip status-suspended">åœæ­¢ä¸­</span>`;
          } else if (r.type === "ticket") {
            if (r.status === "new") return `<span class="status-chip status-pending">æœªå¯¾å¿œ</span>`;
            if (r.status === "open") return `<span class="status-chip status-active">å¯¾å¿œä¸­</span>`;
            if (r.status === "closed") return `<span class="status-chip status-suspended">å¯¾å¿œæ¸ˆ</span>`;
          } else if (r.type === "deposit" || r.type === "withdraw") {
            if (r.status === "pending") return `<span class="status-chip status-pending">ç”³è«‹ä¸­</span>`;
            if (r.status === "completed") return `<span class="status-chip status-active">å®Œäº†</span>`;
            if (r.status === "user_cancel") return `<span class="status-chip status-suspended">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>`;
            if (r.status === "admin_cancel") return `<span class="status-chip status-suspended">ç®¡ç†å´ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>`;
          }
          return `<span class="status-chip status-suspended">${r.statusLabel || "ä¸æ˜"}</span>`;
        })();

        const amountText =
          r.amount == null
            ? "-"
            : r.amount.toLocaleString("en-US", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              });

        tr.innerHTML = `
          <td>${r.createdAt}</td>
          <td>${r.typeLabel}</td>
          <td>${r.nameOrTitle}</td>
          <td>${r.userId || "-"}</td>
          <td>${r.affiliateCode || "-"}</td>
          <td class="amount">${amountText}</td>
          <td>${statusChip}</td>
        `;
        tableBody.appendChild(tr);
      });

      tableMeta.textContent = `${filteredRows.length}ä»¶ã‚’è¡¨ç¤ºä¸­`;
    }

    function updateSummary() {
      const userCount = rows.filter((r) => r.type === "user").length;
      const ticketNewCount = rows.filter(
        (r) => r.type === "ticket" && r.status === "new"
      ).length;
      const depPendingCount = rows.filter(
        (r) => r.type === "deposit" && r.status === "pending"
      ).length;
      const wdPendingCount = rows.filter(
        (r) => r.type === "withdraw" && r.status === "pending"
      ).length;

      sumUsersEl.textContent = userCount;
      sumTicketsNewEl.textContent = ticketNewCount;
      sumDepPendingEl.textContent = depPendingCount;
      sumWdPendingEl.textContent = wdPendingCount;
    }

    // ã‚½ãƒ¼ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆ
    document.querySelectorAll("th.sortable").forEach((th) => {
      th.addEventListener("click", () => {
        const key = th.dataset.sortKey;
        if (!key) return;
        if (currentSortKey === key) {
          currentSortDir = currentSortDir === "asc" ? "desc" : "asc";
        } else {
          currentSortKey = key;
          currentSortDir = "asc";
        }
        // ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿æ›´æ–°
        document.querySelectorAll("th.sortable .sort-indicator").forEach((el) => {
          el.textContent = "";
        });
        const indicator = th.querySelector(".sort-indicator");
        indicator.textContent = currentSortDir === "asc" ? "â–²" : "â–¼";

        applySort();
        renderTable();
      });
    });

    // æ¤œç´¢ãƒœã‚¿ãƒ³
    btnSearch.addEventListener("click", applyFilters);

    // æ¡ä»¶ã‚¯ãƒªã‚¢
    btnClear.addEventListener("click", () => {
      qTextEl.value = "";
      qAffEl.value = "";
      qFromEl.value = "";
      qToEl.value = "";
      filteredRows = rows.slice();
      applySort();
      renderTable();
    });

    // åˆæœŸåŒ–
    function init() {
      updateSummary();
      // æ—¥ä»˜åˆæœŸå€¤ï¼šç›´è¿‘7æ—¥é–“
      const today = new Date();
      const isoToday = today.toISOString().slice(0, 10);
      const weekAgo = new Date(today.getTime() - 6 * 24 * 60 * 60 * 1000);
      const isoWeekAgo = weekAgo.toISOString().slice(0, 10);
      qToEl.value = isoToday;
      qFromEl.value = isoWeekAgo;

      applyFilters();
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚½ãƒ¼ãƒˆã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿
      const th = document.querySelector('th[data-sort-key="createdAt"]');
      if (th) {
        th.querySelector(".sort-indicator").textContent = "â–¼";
      }
    }

    init();
  </script>
</body>
</html>
